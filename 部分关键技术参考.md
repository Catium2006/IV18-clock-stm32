# 部分关键技术参考
注: 公式已经全部使用$\rm{\LaTeX}$渲染

## 温度传感器
温度传感器使用的是`NTC3435`热敏电阻, 其 $25$ 摄氏度时标称阻值为 $10\ K\Omega$ , 随温度降低阻值升高, 温度升高阻值减小, 温度为 $100\ ^\circ C$ 时电阻约为 $950\ \Omega$ , 温度为 $0\ ^\circ C$ 时电阻约为 $27\ K\Omega$ .  

其温度-阻值函数是不均匀的.  

温度计程序内置了一张表, 记录某个阻值对应的温度是多少, 通过测量阻值即可查询到相应温度.  

由于单片机没有直接测量阻值的功能, 只能采用分压的方法测量电压模拟值, 然后算出电阻.  

具体分压电路为: `NTC3435`串联一支标称 $10\ K\Omega$ 的定值电阻, 定值电阻空脚接地, `NTC3435`空脚接 $5\ V$ 电源正极, 随着温度变化, 热敏电阻阻值变化, 两个电阻分压就会变化.  

测量定值电阻上的电压即可计算出热敏电阻的阻值, 推导如下:  

`STM32F103C8`单片机模拟输入最大值为 $3.3\ V$ , 计算并查表发现安全上限温度为 $45\ ^\circ C$ , 日常生活基本不会遇到, 足矣.  

单片机在`Arduino`框架下模拟输入返回的是`0~1023`之间的整数 $A$ , 设测量到定值电阻的电压为 $U$ , 有恒等式:

$$

U = 3.3\ V \times \frac{A}{1023}

$$  

设热敏电阻阻值为 $R_T$ , 定值电阻阻值为 $R_S$ , 由串联电路分压规律可列等式:  

$$

U = \frac{R_S}{R_T + R_S} \times 5\ V

$$

联立二式, 得:  

$$

\frac{R_S}{R_T + R_S} \times 5\ V = \frac{A}{1023} \times 3.3\ V

$$

整理得:  

$$

R_T = \frac{1023 \times 5\ V \times R_S }{ (3.3\ V \times A) - R_S}

$$

其中 $R_S$ 已知为 $10\ K\Omega$ , 只需取模拟值 $A$ , 就可以计算出 $R_T$  

由于温度-阻值表仅精确到 $1\ ^\circ C$ , 小数点后面需要用插值近似计算出来.  

为了方便我采用了线性插值.

> 线性插值是指插值函数为一次多项式的插值方式，其在插值节点上的插值误差为零。线性插值相比其他插值方式，如抛物线插值，具有简单、方便的特点。线性插值可以用来近似代替原函数，也可以用来计算得到查表过程中表中没有的数值。

设真实温度为 $T$ , 表中近似而较高的阻值为 $R_h$ , 近似而较低的阻值为 $R_l$ , 这两个阻值对应的准确温度为 $T_h$ 和 $T_h + 1$ , 则:

$$

T = T_h + 1 + \frac{R_T - R_l}{R_h - R_l}
 
$$

至此, 我们已经近似计算出了真实温度, 误差很小, 应该在 $1\%$ 是没问题的.  

其实误差瓶颈应该在电阻的制造误差和模拟输入的精度误差.  

摄氏度换算华氏度和开尔文, 读者自查资料不难.  

~~我公式推导应该没写错吧, 反正程序里面写的是对的(逃)~~  

