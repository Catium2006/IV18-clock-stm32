2022年端午高考期间,做ИВ18荧光时钟一个,赠\[数据删除\]. 特做此日志纪念.

在完成之前会一直更新\(大概\)

## 5月底

### 25日
看见了ИВ18这款前苏联战争遗物,觉得很好看,了解了一下觉得可做.

有一说一,这种荧光管虽然没有辉光管好看,但是也已经相当好看了.

### 26日
参考CSDN开始画了原理图,有点小复杂,因为我已经一年多没有接触过电子这方面的东西了.

### 28日
原理图绘制完毕,开始画PCB.

意外的发现PCB还挺好画的.

### 29日

PCB不知道什么元件的封装位置被我给删了,重画一遍...

### 30日
PCB上画了一只诹访子,因为时间观念嘛.

PCB画完了,送去打板子.

打板子是完全免费的.

采购材料,发现立创商城里面有的元件不全或者很贵,改为淘宝购买,痛失50.

买了一只ИВ18,痛失106.

### 31日
决定使用DS1302作为时钟芯片.

采购材料,买充电模块之类的,痛失50.

开始学习STM32开发,决定使用Arduino框架开发.

VSCode上装了PlatformIO插件,很好用.

学会了STM32 Arduino框架的基本使用,找了一个RTC驱动库.

另外,工程代码和竞赛代码的最大区别是,工程代码你只需要知道怎么把东西拼起来就好了,很多实现已经有人帮你封装好了

## 6月

### 1日
STM32F103C8T6开发板送到了,写了一个点灯程序,运行的很好.

意外的发现这个芯片是国产仿制的,多费我20块钱...

写了一种基于信号采集和位运算的真随机数发生器,表现还不错.

意外的发现硬件电路设计的有问题,PC13脚是连着led的,并且PC13-15会被芯片内部占用.

另外,说句闲话,学习STM32的最好办法是,~~烧坏几个板子.~~

> 备注:5号烧坏了一个板子

硬件的问题找了几个解决方案,好像都不太靠谱,于是索性就摆烂了.

### 2日
完成了软件部分6大功能中的3个,但未经测试.

收到了ИВ18,非常的好看,更加坚定了我做成这个时钟的信念,从而更加坚定了我喜欢\[数据删除\]的信念.

### 3日
板子到了,配件也都到齐了,晚上回家浅浅焊接了一下,发现自己的焊接技术退化严重,C1206封装都焊不好了,幸亏不需要手动焊STM32.

接好了5V转3V3的供电,然后上电,很意外的短路了.检查一遍没发现问题,正反向电阻都是无穷大,按理说不该短路.

再上电还是短路,一摸发现所有的钽电容都烫的,拆下电容之后电路正常工作,由此推断是电容的锅.

按理说电容耐压16V,电源是5V不该击穿,那只能说我焊接的时候把电容烧坏了吧 \\kk.

作为我第一次自己设计,焊接的贴片电路,这块板子还是有不少缺陷的.而且那个神秘烙铁头他他他不上锡,我真服了呀.很有可能电容就是因为这种奇葩原因烧坏的.

### 4日
考虑不装电容或者外接直插电容,钽电容太金贵了...

不装电容的话按理说也没有问题,就是可能会不太稳定,到时候再说吧.

反正是滤波用的电容,STM32板子上本身有电容,应该可以替代了,然后分析一下电路发现3V3负载只有灯丝和单片机,5V负载有3个集成电路,稳定性不好说.

尤其是升压电路附近,必然有干扰.

另外,记得要把烙铁头打磨一下.

又稍微写了写软件部分的代码,但是感觉没什么动力啊,毕竟硬件没有做好不能测试,也无法判断正确性.

开始有点害怕了,100多个焊点,还有密度比较高的封装,担心焊不好.

另外,我发现我不能对开发板进行调试,可能是盗版STM32的问题吧\(

有没有图片配上这篇文章呢? 我也不知道.

啊,用中午的时间换了电容,只有3*1uF,并且发现抛光之后的烙铁头非常好用,非常好用,非常好用,尤其是在焊接贴片元件的时候. \\kk

啊,然后装上了boost升压部分,果然还是不输出高压的 \\kk

啊,测试了一下发现果然是反馈电路的问题,需要让反馈分压电阻高压侧为断路才能有输出,没大容量滤波电容时候空载72V左右,接上HV5812之后63V.

啊,现在已经做完了大部分电路了,晚上估计就能焊好.

啊,晚上查了一下开关电源升压芯片XL6007E1的资料,FB脚的反馈电压应该是1.5伏,然后我现在是接地了,虽然能有输出但是可能不太稳定,晚上回家串个电阻,如果FB一直接地的话会导致空载功率虚高\(大概\).

啊,然后XL6007E1的EN脚设置为LOW\(默认为HIGH\)的时候可以停止输出,文档上好像没有写时序要求,看看能不能用占空比调制输出功率,或者用stm32直接输出模拟信号到FB脚上.

啊,目前看来电路设计的还比较不错,至少能用对吧\(

啊,晚上回家估计就能把元件全装上了,然后就可以开始测试我软件的正确性啦\(

今天白天给宝硕看了看我打的板子,不愧是宝硕,对这方面也有研究,一猜就知道我是在嘉立创打的板子,但是可能他不知道现在每个月可以免费打样两次了.

突然觉得软件部分写的好丑,准备重构一部分.

### 5日
安装好了最后一部分电路,上电,除了RTC模块未经测试,其他部分均正常工作.

IV18终于点亮了,真好看啊....

阳极电压有点小高,看起来太亮了,估计会折寿.还是想办法调一下升压电路的反馈吧.

其实我也可以用单片机输出模拟信号来控制升压电路\(?

然后发现移位寄存器的那几个位标志的位置不太对,有时间了要根据实际情况调整一下.

然后就很神秘,我还是不能调试,只能通过板子上的电位来判断运行情况.

判断了P_POWER_EN脚控制输出功率方案不可行.

打算再买一只ИВ18了.

中午出了点意外情况:

我真服了啊,本来都已经安装好灯管了结果高压侧碰了一下低压侧,直接给我XL6007E1送走了,STM32板子也废了一块,我真是服了啊.

气死我了,本来都已经安装好能够点亮了.

超,STM32板子也烧坏了,这可是贵的啊...

然后RTC模块和晶振部分受损情况未知,这些件搞坏了到是不怕,因为我准备了备用件.

现在最担心的就是ИВ18里面那根灯丝会不会受损.灯管我可没买备用的,要是灯丝坏了那就彻底完蛋完蛋完蛋.

贴片的这几个电容估计都能幸存,然后LDO测试也能正常输出,然后时钟备用电池不知道会不会击穿,希望只有XL6007E1和STM32坏了就最好.

我真服了呀,我但凡稍等一会儿等他放完电再去处理线头也不会出这事儿.

晚上回去一定要给高压侧加上泄放电阻,然后XL6007E1的反馈分压电阻也要搞一下,要不然对灯管的损害太大(如果灯管没挂的话)

如果灯管挂了那我就再买2只好了\(

哎,本来是想做两套然后送人一套自己留一套的,结果现在配件肯定是不够了.

保险起见最好是吧时钟模块也换了,然后晶振也换了.

希望晚上要是不上晚自习就好了.

我好伤心啊 /kk

以后再也不敢违规操作了

确定下操作规则:

    1.进行焊接,机械连接等操作时候去下STM32核心板
    2.进行任何操作前必须确定高压侧电容的电压在5V一下,如果大于5V需要先放电.
    3.严格按照标准电路连接,禁止违规操作.
    4.高压部分必须隔离,多余电荷及时放出.
    5.严格注意反接\(电源或原件\)的问题.
### 6日
重新焊接了一块板子,幸亏我有备用原件.

上电,一次成功点亮!

我真是太高兴啦.

然后开始做外壳部分,用电热丝切割了两篇亚克力板子放到两侧做头,然后侧面镂空.

电源使用的是1节18650电池,松下的,3300mAh.

先用\(?\)充电宝模块升压到5V给主电路供电,然后充电宝模还集成了充放电保护.

用上次没用完的502沾到亚克力板上了,还有电池也是.

我超,真的是太好看啦

赶紧写了个HelloWorld,烧上去一看发现字符是乱的,然后就手动确定了一下源代码里宏定义的字段电平,发现应该是从低位到高位输出,我写的是从高位到低位输出,怪不得不能用呢.

目前知道电源部分完全没有问题了,然后软件也测试了一部分.

暂时不知道RTC芯片是否工作正常.